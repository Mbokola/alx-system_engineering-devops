#!/usr/bin/env bash

# Define the custom header name and value
custom_header_name="X-Served-By"
custom_header_value="$(hostname)"

# Define the Nginx configuration file path
nginx_config_file="/etc/nginx/sites-available/default"

# Check if the Nginx configuration file exists
if [ -f "$nginx_config_file" ]; then
    # Use sed to add the custom header to the Nginx configuration file
    sudo sed -i "/server_name _;/a \ \n    add_header $custom_header_name \"$custom_header_value\";" "$nginx_config_file"

    # Test the Nginx configuration for syntax errors
    sudo nginx -t

    # Reload Nginx to apply the changes
    sudo systemctl reload nginx

    echo "Custom header '$custom_header_name' with value '$custom_header_value' added to Nginx configuration."
else
    echo "Nginx configuration file not found at '$nginx_config_file'. Please check the file path."
fi
